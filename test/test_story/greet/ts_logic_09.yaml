################################################
# date: 2018/4/20
# spec: test conductor basic logic of parallel.
# parallel nested in parallel
# author: x-lab.Leo
################################################

---
schema:
  steps:
    -
      id: 1
      name: inject-cpu-workload
      type: test
      service:
        name: greet
        call: REST
      action: start
      args:
        method: GET
        command: greet
        args:
          name: Leo

    -
      id: 2
      name: monitor-cpu-utility
      type: test
      service:
        name: greet
        call: REST
      action: start
      args:
        method: POST
        command: answer
        args:
          ping: ping_from_Leo

    -
      id: 3
      name: inject-cpu-workload
      type: test
      service:
        name: greet
        call: REST
      action: start
      args:
        method: POST
        command: answer
        args:
          ping: ping_from_Leo_2

    -
      id: 4
      name: monitor-cpu-utility
      type: test
      service:
        name: greet
        call: REST
      action: start
      args:
        method: POST
        command: answer
        args:
          ping: ping_from_Leo_3

    -
      id: 5
      name: inject-cpu-workload
      type: test
      service:
        name: greet
        call: REST
      action: start
      args:
        method: POST
        command: answer
        args:
          ping: ping_from_Leo_4

    -
      id: 6
      name: monitor-cpu-utility
      type: test
      service:
        name: greet
        call: REST
      action: start
      args:
        method: POST
        command: answer
        args:
          ping: ping_from_Leo_5

  flows:
    -
      name: main
      orders:
        -
          type: normal
          step: 1
        -
          type: parallel
          parallel:
            p1:
              -
                type: normal
                step: 2
              -
                type: parallel
                parallel:
                  p1:
                    -
                      type: normal
                      step: 3
                  p2:
                    -
                      type: normal
                      step: 4
                    -
                      type: normal
                      step: 5
            p2:
              -
                type: normal
                step: 6
