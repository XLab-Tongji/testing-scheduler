################################################
# date: 2018/4/20
# spec: test basic logic with service: greet
# author: x-lab.Leo
################################################

---
schema:
  steps:
    -
      id: 1
      name: add_stress
      type: test
      service:
        name: loop
        call: REST
      action: start
      args:
        method: POST
        command: stress
        args:
          concurrent_num: 5
    -
      id: 2
      name: bottleneck_checker
      type: test
      service:
        name: loop
        call: REST
      action: start
      args:
        method: GET
        command: reach

    -
      id: 3
      name: greet1
      type: test
      service:
        name: greet
        call: REST
      action: start
      args:
        method: POST
        command: answer
        args:
          ping: ping_from_Leo

  flows:
    -
      name: main
      orders:
        -
          type: loop
          name: stress-loop
          body:
            -
              type: normal
              step: 1   
          check:
            -
              type: normal
              step: 2
          change:
            add_stress:
              concurrent_num: +=5
        -
          type: normal
          step: 3