################################################
# date: 2018/4/20
# spec: test the scenario of clearwater experiment
# author: x-lab.Leo
################################################

---
schema:
  steps:
    -
      id: 1
      name: set-up-zabbix-agent
      type: test
      action: start
      service:
        name: monitor-zabbix
        interface: setup
      args:
        name: clearwater-all

    -
      id: 2
      name: start-monitor
      type: test
      action: start
      service:
        name: monitor-zabbix
        interface: start
      args:
        name: start

    -
      id: 3
      name: simulate-mass-call
      type: test
      action: start
      service:
        name: ansible
        interface: workload
      args:
        reg_user: 1000
        call_user: 500
        duration: 1
        initial_reg_rate: 100
        multiplier: 225
    
    -
      id: 4
      name: inject-random-fault
      type: test
      action: start
      service:
        name: ansible
        interface: faultload
      args:
        reg_user: 1000
        call_user: 500
        duration: 1
        initial_reg_rate: 100
        multiplier: 225
        fault_duration: 2

    -
      id: 5
      name: data-collection
      type: test
      action: start
      service:
        name: grafana
        interface: collect-data
      args:
        name: cassandra


  flows:
    -
      name: main
      orders:
        -
          type: normal
          step: 1
        -
          type: normal
          step: 2
        -
          type: normal
          step: 3
        -
          type: normal
          step: 4
        -
          type: normal
          step: 5